<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta name="google-site-verification" content="jk_P6ub99gOREVqLFGd54Xe1Dgp57gAS248_qlRzIJg" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Twitter Sentiment Analysis with a CNN</title>
  <meta name="description" content="TensorFlow implementation of a CNN for Twitter Sentiment Analysis">
  <link rel="canonical" href="http://localhost:4000/twitter-sentiment-analysis-with-a-cnn">
  <link rel="alternate" type="application/rss+xml" title="Artificial Mind Blog. Feed"
    href="http://localhost:4000/feed.xml">
  
  <!-- Styles -->
  <link href="https://fonts.googleapis.com/css?family=Lato:400,400i,700,700i%7CNoto+Serif:400,400i,700,700i&display=swap" rel="stylesheet">
  <link href="/assets/css/style.css" rel="stylesheet">
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Twitter Sentiment Analysis with a CNN | Artificial Mind Blog.</title>
<meta name="generator" content="Jekyll v4.0.1" />
<meta property="og:title" content="Twitter Sentiment Analysis with a CNN" />
<meta name="author" content="Mohamed BEN HAMDOUNE" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="TensorFlow implementation of a CNN for Twitter Sentiment Analysis" />
<meta property="og:description" content="TensorFlow implementation of a CNN for Twitter Sentiment Analysis" />
<link rel="canonical" href="http://localhost:4000/twitter-sentiment-analysis-with-a-cnn" />
<meta property="og:url" content="http://localhost:4000/twitter-sentiment-analysis-with-a-cnn" />
<meta property="og:site_name" content="Artificial Mind Blog." />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-09-22T00:00:00+01:00" />
<meta name="google-site-verification" content="jk_P6ub99gOREVqLFGd54Xe1Dgp57gAS248_qlRzIJg" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://localhost:4000/twitter-sentiment-analysis-with-a-cnn","headline":"Twitter Sentiment Analysis with a CNN","dateModified":"2019-09-22T00:00:00+01:00","datePublished":"2019-09-22T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/twitter-sentiment-analysis-with-a-cnn"},"author":{"@type":"Person","name":"Mohamed BEN HAMDOUNE"},"description":"TensorFlow implementation of a CNN for Twitter Sentiment Analysis","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>
<body>

  <div id="page" class="site">
    <div class="inner">
      <header class="site-header">
  
  <p class="site-title"><a class="logo-text" href="/">Artificial Mind Blog.</a></p>
  
  <nav class="site-navigation">
    <div class="site-navigation-wrap">
      <h2 class="screen-reader-text">Main navigation</h2>
      <ul class="menu">
        
        
        
        <li class="menu-item ">
          <a class="" href="/">Home</a>
        </li>
        
        
        
        <li class="menu-item ">
          <a class="" href="/curriculum-vitae/">Curriculum Vitae</a>
        </li>
        
        
        
        <li class="menu-item ">
          <a class="" href="/tags/">Archive</a>
        </li>
        
        
        
        <li class="menu-item ">
          <a class="" href="/about/">About</a>
        </li>
        
      </ul>
<!-- .menu -->
      <button id="menu-close" class="menu-toggle"><span class="screen-reader-text">Close Menu</span><span class="icon-close" aria-hidden="true"></span></button>
    </div>
<!-- .site-navigation-wrap -->
  </nav><!-- .site-navigation -->
  <button id="menu-open" class="menu-toggle"><span class="screen-reader-text">Open Menu</span><span class="icon-menu" aria-hidden="true"></span></button>
</header>




      <main class="main-content fadeInDown delay_075s">

  <article class="post">
    <header class="post-header">
      <time class="post-date" datetime="2019-09-22">September 22, 2019</time>
      <h1 class="post-title">Twitter Sentiment Analysis with a CNN</h1>
      <div class="post-meta">
        By <span class="post-author">Mohamed BEN HAMDOUNE</span><span class="post-tags"> in <a href="/tags/#Sentiment+Analysis" rel="tag">Sentiment Analysis</a>, <a href="/tags/#Twitter" rel="tag">Twitter</a>, <a href="/tags/#CNN" rel="tag">CNN</a>, <a href="/tags/#Convolutional" rel="tag">Convolutional</a>, <a href="/tags/#Neural+Network" rel="tag">Neural Network</a>, <a href="/tags/#Deep+Learning" rel="tag">Deep Learning</a>, <a href="/tags/#Tensorflow" rel="tag">Tensorflow</a></span>
      </div>
<!-- .post-meta -->
      
    </header><!-- .post-header -->
    <div class="post-content">
      <p><em>Presentation of a TensorFlow implementation of a CNN for Twitter Sentiment Analysis available on my <a href="https://github.com/mbenhamd/twitter-sentiment-cnn">Github repository</a></em>:</p>

<h3 id="tensorflow-implementation-of-a-cnn">TensorFlow implementation of a CNN.</h3>

<h6 id="part-of-the-twitter-sentiment-analysis-project">Part of the Twitter Sentiment Analysis Project</h6>

<p><em>Link of the publication : <a href="https://github.com/mbenhamd/database-publication-latex/blob/master/publication.pdf">here</a></em></p>

<p>We used those settings for training the CNN :</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Flags:
	batch_size = 128
	checkpoint_freq = 1
	custom_input =
	dataset_fraction = 1.0
	device = gpu
	embedding_size = 128
	epochs = 10
	evaluate_batch = False
	filter_sizes = 3,4,5
	load = None
	num_filters = 128
	save = True
	save_protobuf = False
	test_data_ratio = 0.1
	train = True
	valid_freq = 1

Dataset:
	Train set size = 1420766
	Test set size = 157862
	Vocabulary size = 274562
	Input layer size = 117
	Number of classes = 2

On a GTX 1060 (1280 cuda cores), we did 110 990 iterations (10 epochs) :
</code></pre></div></div>
<!--more-->
<p>The CNN is about 424,1 Mo, it is a result of (round) 2h20 minute of computation with the GPU. At the end, the neural network comes up with a validation accuracy of 82%.</p>

<p>Here some plot about the validation accuracy and training loss : <img src="https://github.com/mbenhamd/twitter-sentiment-cnn/blob/master/validation-accuracy.png?raw=true" alt="alt text" title="Validation Accuracy"> <img src="https://github.com/mbenhamd/twitter-sentiment-cnn/blob/master/training-loss.png?raw=true" alt="alt text" title="Training Loss"></p>

<p><em>It is based on a previous work of Daniele Grattarola</em></p>

<h6 id="description">Description</h6>

<p>This code is meant to have an educational value, to train the model by yourself and play with different configurations, and was not developed to be deployed as-is (although it has been used in <a href="https://linkedin.com/pulse/real-time-twitter-sentiment-analytics-tensorflow-spring-tzolov/">professional contexts</a>). The dataset used for training is taken from <a href="http://thinknook.com/twitter-sentiment-analysis-training-corpus-dataset-2012-09-22/">here</a> (someone reported to me that the link to the dataset appears to be dead sometimes, so <code class="highlighter-rouge">dataset_downloader.py</code> <strong>might</strong> not work. I successfully ran the script on January 20, 2018, but please report it to me if you have any problems).</p>

<p><strong>NOTE: this script is for Python 2.7 only</strong></p>

<h6 id="setup">Setup</h6>

<p>You’ll need Tensorflow &gt;=1.1.0 and its dependecies installed in order for the script to work (see <a href="https://www.tensorflow.org/">here</a>).</p>

<p>Once you’ve installed and configured Tensorflow, download the source files and <code class="highlighter-rouge">cd</code> into the folder:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://gitlab.com/danielegrattarola/twitter-sentiment-cnn.git
<span class="nv">$ </span><span class="nb">cd </span>twitter-sentiment-cnn
</code></pre></div></div>

<p>Before being able to use the script, some setup is needed; download the dataset from the link above by running:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python dataset_downloader.py
</code></pre></div></div>

<p>Read the dataset from the CSV into two files (.pos and .neg) with:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python csv_parser.py
</code></pre></div></div>

<p>And generate a CSV with the vocabulary (and its inverse mapping) with:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python vocab_builder.py
</code></pre></div></div>

<p>The files will be created in the <code class="highlighter-rouge">twitter-sentiment-dataset/</code> folder. Finally, create an <code class="highlighter-rouge">output/</code> folder that will contain all session checkpoints needed to restore the trained models:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>output
</code></pre></div></div>

<p>Now everything is set up and you’re ready to start training the model.</p>

<h6 id="usage">Usage</h6>

<p>The simplest way to run the script is:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python twitter-sentiment-cnn.py
</code></pre></div></div>

<p>which will load the dataset in memory, create the computation graph, and quit. Try to run the script like this to see if everything is set up correctly. To run a training session on the full dataset (and save the result so that we can reuse the network later, or perform more training) run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python twitter-sentiment-cnn.py <span class="nt">--train</span> <span class="nt">--save</span>
</code></pre></div></div>

<p>After training, we can test the network as follows:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python twitter-sentiment-cnn.py <span class="nt">--load</span> path/to/ckpt/folder/ <span class="nt">--custom_input</span> <span class="s1">'I love neural networks!'</span>
</code></pre></div></div>

<p>which will eventually output:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
Processing custom input: I love neural networks!
Custom input evaluation: POS
Actual output: [ 0.19249919  0.80750078]
...
</code></pre></div></div>

<p>By running:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>python twitter-sentiment-cnn.py <span class="nt">-h</span>
</code></pre></div></div>

<p>the script will output a list of all customizable flags and parameters. The parameters are:</p>

<ul>
  <li>
<code class="highlighter-rouge">train</code>: train the network;</li>
  <li>
<code class="highlighter-rouge">save</code>: save session checkpoints;</li>
  <li>
<code class="highlighter-rouge">save_protobuf</code>: save model as binary protobuf;</li>
  <li>
<code class="highlighter-rouge">evaluate_batch</code>: evaluate the network on a held-out batch from the dataset and print the results (for debugging/educational purposes);</li>
  <li>
<code class="highlighter-rouge">load</code>: restore a model from the given path;</li>
  <li>
<code class="highlighter-rouge">custom_input</code>: evaluate the model on the given string;</li>
  <li>
<code class="highlighter-rouge">filter_sizes</code>: comma-separated filter sizes for the convolutional layers (default: ‘3,4,5’);</li>
  <li>
<code class="highlighter-rouge">dataset_fraction</code>: fraction of the dataset to load in memory, to reduce memory usage (default: 1.0; uses all dataset);</li>
  <li>
<code class="highlighter-rouge">embedding_size</code>: size of the word embeddings (default: 128);</li>
  <li>
<code class="highlighter-rouge">num_filters</code>: number of filters per filter size (default: 128);</li>
  <li>
<code class="highlighter-rouge">batch_size</code>: batch size (default: 128);</li>
  <li>
<code class="highlighter-rouge">epochs</code>: number of training epochs (default: 3);</li>
  <li>
<code class="highlighter-rouge">valid_freq</code>: how many times per epoch to perform validation testing (default: 1);</li>
  <li>
<code class="highlighter-rouge">checkpoint_freq</code>: how many times per epoch to save the model (default: 1);</li>
  <li>
<code class="highlighter-rouge">test_data_ratio</code>: fraction of the dataset to use for validation (default: 0.1);</li>
  <li>
<code class="highlighter-rouge">device</code>: device to use for running the model (can be either ‘cpu’ or ‘gpu’).</li>
</ul>

<h6 id="pre-trained-model">Pre-trained model</h6>

<p>User <a href="https://github.com/Horkyze">@Horkyze</a> kindly trained the model for three epochs on the full dataset and shared the summary folder for quick deploy. The folder is available on <a href="https://mega.nz/#!xVg0ARYK!oVyBZatotQGOD_FFSzZl5gTS1Z49048vjFEbyzftcFY">Mega</a>, to load the model simply unpack the zip file and use the <code class="highlighter-rouge">--load</code> flag as follows:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Current directoty: twitter-sentiment-cnn/</span>
<span class="nv">$ </span>unzip path/to/run20180201-231509.zip
<span class="nv">$ </span>python twitter-sentiment-cnn.py <span class="nt">--load</span> path/to/run20180201-231509/ <span class="nt">--custom_input</span> <span class="s2">"I love neural networks!"</span>
</code></pre></div></div>

<p>Running this command should give you something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>======================= START! ========================
	data_helpers: loading positive examples...
	data_helpers: [OK]
	data_helpers: loading negative examples...
	data_helpers: [OK]
	data_helpers: cleaning strings...
	data_helpers: [OK]
	data_helpers: generating labels...
	data_helpers: [OK]
	data_helpers: concatenating labels...
	data_helpers: [OK]
	data_helpers: padding strings...
	data_helpers: [OK]
	data_helpers: building vocabulary...
	data_helpers: [OK]
	data_helpers: building processed datasets...
	data_helpers: [OK]

Flags:
	batch_size = 128
	checkpoint_freq = 1
	custom_input = I love neural networks!
	dataset_fraction = 0.001
	device = cpu
	embedding_size = 128
	epochs = 3
	evaluate_batch = False
	filter_sizes = 3,4,5
	load = output/run20180201-231509/
	num_filters = 128
	save = False
	save_protobuf = False
	test_data_ratio = 0.1
	train = False
	valid_freq = 1

Dataset:
	Train set size = 1421
	Test set size = 157
	Vocabulary size = 274562
	Input layer size = 36
	Number of classes = 2

Output folder: /home/phait/dev/twitter-sentiment-cnn/output/run20180208-112402
Data processing OK, loading network...
Evaluating custom input: I love neural networks!
Custom input evaluation: POS
Actual output: [0.04109644 0.95890355]
</code></pre></div></div>

<p><strong>NOTE: loading this model won’t work if you change anything in the default network architecture, so don’t set the <code class="highlighter-rouge">--filter_sizes</code> flag</strong>.</p>

<p>According to the <code class="highlighter-rouge">log.log</code> file provided by <a href="https://github.com/Horkyze">@Horkyze</a>, the model had a final validation accuracy of 0.80976, and a validation loss of 53.3314.</p>

<p>I sincerely thank <a href="https://github.com/Horkyze">@Horkyze</a> for providing the computational power and sharing the model with me.</p>

<h6 id="model-description">Model description</h6>

<p>The network implemented in this script is a single layer CNN structured as follows:</p>

<ul>
  <li>
<strong>Embedding layer</strong>: takes as input the tweets (as strings) and maps each word to an n-dimensional space so that it is represented as a sparse vector (see <a href="https://en.wikipedia.org/wiki/Word2vec">word2vec</a>).</li>
  <li>
<strong>Convolution layers</strong>: a set of parallel 1D convolutional layers with the given filter sizes and 128 output channels. A filter’s size is the number of embedded words that the filter covers.</li>
  <li>
<strong>Pooling layers</strong>: a set of pooling layers associated to each of the convolutional layers.</li>
  <li>
<strong>Concat layer</strong>: concatenates the output of the different pooling layers into a single tensor.</li>
  <li>
<strong>Dropout layer</strong>: performs neuron dropout (some neurons are randomly not considered during training).</li>
  <li>
<strong>Output layer</strong>: fully connected layer with a softmax activation function to perform classification.</li>
</ul>

<p>The script will automatically log the session with Tensorboard. To visualize the computation graph and training metrics run:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tensorboard <span class="nt">--logdir</span> output/path/to/summaries/
</code></pre></div></div>

<p>and then navigate to <code class="highlighter-rouge">localhost:6006</code> from your browser (you’ll see the computation graph in the <em>Graph</em> section).</p>

    </div>
<!-- .post-content -->
    <div class="post-share">
      <span>Share:</span>
      <a target="_blank" href="https://twitter.com/intent/tweet?text=Twitter%20Sentiment%20Analysis%20with%20a%20CNN&amp;url=http://localhost:4000/twitter-sentiment-analysis-with-a-cnn" rel="noopener">Twitter</a>
      <a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/twitter-sentiment-analysis-with-a-cnn&amp;t=Twitter%20Sentiment%20Analysis%20with%20a%20CNN" rel="noopener">Facebook</a>
    </div>
<!-- .share-post -->
    <div class="author-box">
      
      <div class="author-avatar" style="background-image: url('/images/author.png')"><span class="screen-reader-text">Mohamed BEN HAMDOUNE's Picture</span></div>
      
      <div class="author-details">
        <h2 class="author-title">About Mohamed BEN HAMDOUNE</h2>
        <div class="author-bio">
<p>Mohamed is a Data Scientist working at Zifo RnD Solutions.</p>
</div>
        
        <span class="author-location">Cmabridge, United Kingdom</span>
        
        
        <span class="author-website"><a href="https://mbenhamd.github.io/" target="_blank" rel="noopener">https://mbenhamd.github.io/</a></span>
        
      </div>
<!-- .author-details -->
    </div>
<!-- .author-box -->
  </article><!-- .post -->

  
    <div class="comments-area">
  <div class="comments-inner">
    <h2 class="comments-title">Comments</h2>
    <div id="disqus_thread"></div>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by
        Disqus</a>.</noscript>
  </div>
<!-- .comments-inner -->
</div>
<!-- .comments-area -->

<script type="text/javascript">
  var disqus_shortname = 'justgoodthemes';
  var disqus_developer = 0;
  (function () {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
  

</main><!-- .main-content -->
      <footer class="site-footer">
  <div class="offsite-links">
    
      
<a href="https://twitter.com/mbenhamdtw" target="_blank" rel="noopener">
  <span class="fa-twitter" aria-hidden="true"></span>
  <span class="screen-reader-text">Twitter</span>
</a>

<a href="https://github.com/mbenhamd" target="_blank" rel="noopener">
  <span class="fa-github" aria-hidden="true"></span>
  <span class="screen-reader-text">GitHub</span>
</a>

<a href="https://www.linkedin.com/in/mohamed-ben-hamdoune-73197392/" target="_blank" rel="noopener">
  <span class="fa-linkedin" aria-hidden="true"></span>
  <span class="screen-reader-text">LinkedIn</span>
</a>

    
  </div>
<!-- .offsite-links -->
  <div class="footer-bottom">
    <div class="site-info">
      <p>Artificial Mind Blog. Jekyll Theme Forked <a href="https://github.com/JustGoodThemes/Scriptor-Jekyll-Theme">Here</a>.</p>

    </div>
<!-- .site-info -->
    <a href="#page" id="back-to-top" class="back-to-top"><span class="screen-reader-text">Back to the top </span>↑</a>
  </div>
<!-- .footer-bottom -->
</footer><!-- .site-footer -->

    </div>
<!-- .inner -->
  </div><!-- .site -->

  <!-- Scripts -->
  <script src="/assets/js/plugins.js"></script>
  <script src="/assets/js/custom.js"></script>

</body>
</html>
